<html>
<head>
<title>PlantAdapter.kt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
PlantAdapter.kt</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">fr.adlan.naturecollection.adapter</span>

<span class="s1">import android.net.Uri</span>
<span class="s1">import android.util.Log</span>
<span class="s1">import android.view.LayoutInflater</span>
<span class="s1">import android.view.View</span>
<span class="s1">import android.view.ViewGroup</span>
<span class="s1">import android.widget.ImageView</span>
<span class="s1">import android.widget.TextView</span>
<span class="s1">import androidx.recyclerview.widget.RecyclerView</span>
<span class="s1">import com.bumptech.glide.Glide</span>
<span class="s1">import fr.adlan.naturecollection.*</span>

<span class="s0">class </span><span class="s1">PlantAdapter(</span>
    <span class="s0">val </span><span class="s1">context: MainActivity</span><span class="s0">,</span>
    <span class="s1">private </span><span class="s0">val </span><span class="s1">plantList: List&lt;PlantModel&gt;</span><span class="s0">,</span>
    <span class="s1">private </span><span class="s0">val </span><span class="s1">layoutId: Int</span>
<span class="s1">) : RecyclerView.Adapter&lt;PlantAdapter.ViewHolder&gt;() {</span>

    <span class="s2">// boite pour controler tout les composants à modifier : nom, image...</span>

    <span class="s0">class </span><span class="s1">ViewHolder(view: View) : RecyclerView.ViewHolder(view) {</span>
        <span class="s2">// image de la plante</span>
        <span class="s0">val </span><span class="s1">plantImage = view.findViewById&lt;ImageView&gt;(R.id.image_item)</span>

        <span class="s2">// info plante : nom+description</span>
        <span class="s0">val </span><span class="s1">plantName: TextView? = view.findViewById(R.id.name_item)</span>
        <span class="s0">val </span><span class="s1">plantDescription: TextView? = view.findViewById(R.id.description_item)</span>
        <span class="s0">val </span><span class="s1">starIcon = view.findViewById&lt;ImageView&gt;(R.id.star_icon)</span>

    <span class="s1">}</span>

    <span class="s1">override </span><span class="s0">fun </span><span class="s1">onCreateViewHolder(parent: ViewGroup</span><span class="s0">, </span><span class="s1">viewType: Int): ViewHolder {</span>
        <span class="s0">val </span><span class="s1">view = LayoutInflater</span>
            <span class="s1">.from(parent.context)</span>
            <span class="s1">.inflate(layoutId</span><span class="s0">, </span><span class="s1">parent</span><span class="s0">, false</span><span class="s1">)</span>
        <span class="s0">return </span><span class="s1">ViewHolder(view)</span>
    <span class="s1">}</span>

    <span class="s1">override </span><span class="s0">fun </span><span class="s1">onBindViewHolder(holder: ViewHolder</span><span class="s0">, </span><span class="s1">position: Int) {</span>
        <span class="s2">// récupérer les informations de la plante courante</span>
        <span class="s0">val </span><span class="s1">currentPlant = plantList[position]</span>


        <span class="s2">// récupérer le repository</span>
        <span class="s0">val </span><span class="s1">repo = PlantRepository()</span>
        <span class="s2">// utiliser glide pour recupérer l'image à partir de son lien et l'ajouter au composant</span>
        <span class="s1">Glide.with(context).load(Uri.parse(currentPlant.imageUrl)).into(holder.plantImage)</span>

        <span class="s2">// mise à jour info plante : nom+description</span>
        <span class="s1">holder.plantName?.text = currentPlant.name</span>
        <span class="s1">holder.plantDescription?.text = currentPlant.descriptor</span>

        <span class="s2">//vérifier si la plante a été liké</span>
        <span class="s0">if </span><span class="s1">(currentPlant.liked) {</span>
            <span class="s1">holder.starIcon.setImageResource(R.drawable.ic_star)</span>
        <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
            <span class="s1">holder.starIcon.setImageResource(R.drawable.ic_unstar)</span>
        <span class="s1">}</span>
        <span class="s2">// rajouter interaction du like</span>
        <span class="s1">holder.starIcon.setOnClickListener {</span>
            <span class="s2">// inverser le bouton si on appuie</span>
            <span class="s1">currentPlant.liked = !currentPlant.liked</span>
            <span class="s2">// mettre à jour l'objet plant</span>
            <span class="s1">repo.updatePlant(currentPlant)</span>
        <span class="s1">}</span>
        <span class="s2">// rajouter interaction clic sur une plante</span>
        <span class="s1">holder.itemView.setOnClickListener {</span>
            <span class="s2">// afficher la popup</span>
            <span class="s1">PlantPopup(</span><span class="s0">this, </span><span class="s1">currentPlant).show()</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s1">override </span><span class="s0">fun </span><span class="s1">getItemCount(): Int {</span>

        <span class="s0">return </span><span class="s1">plantList.size</span>
    <span class="s1">}</span>

<span class="s1">}</span></pre>
</body>
</html>